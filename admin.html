<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ë¦¬ì</title>

<style>

body{
font-family:Arial;
background:#f5f6fa;
padding:40px;
}

input,select{
padding:10px;
margin:5px 0;
width:260px;
}

button{
padding:8px 14px;
margin-left:5px;
cursor:pointer;
}

.row{
background:white;
padding:12px;
margin-top:10px;
border-radius:8px;
display:flex;
justify-content:space-between;
align-items:center;
}

.icons span{
font-size:26px;
margin-right:10px;
cursor:pointer;
padding:4px;
border-radius:6px;
}

.icons span.active{
background:#2f80ed;
color:white;
}

.editing{
color:#e67e22;
font-weight:bold;
margin-left:10px;
}

/* ëª¨ë°”ì¼ */

@media (max-width:700px){

body{
padding:18px;
}

input,select{
width:100%;
}

button{
margin-top:6px;
}

.row{
flex-direction:column;
align-items:flex-start;
gap:10px;
}

.icons span{
font-size:24px;
}

}

</style>
</head>

<body>

<div id="loginBox">
<h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
<input type="password" id="pw">
<button onclick="login()">ì ‘ì†</button>
</div>

<div id="adminBox" style="display:none">

<h2>
ì‚¬ì´íŠ¸ ì¶”ê°€ / ìˆ˜ì •
<span id="editingText"></span>
</h2>

<input id="siteName" placeholder="ì‚¬ì´íŠ¸ ì´ë¦„"><br>
<input id="siteUrl" placeholder="URL"><br>

<select id="category"></select>

<div class="icons" id="icons"></div>

<br>

<button onclick="save()">ì €ì¥</button>
<button onclick="cancelEdit()">ì·¨ì†Œ</button>

<h2>ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>

<input id="newCat" placeholder="ì¹´í…Œê³ ë¦¬ ì´ë¦„">
<button onclick="addCat()">ì¶”ê°€</button>

<div id="catList"></div>

<h2>ì‚¬ì´íŠ¸ ëª©ë¡</h2>

<div id="list"></div>

</div>

<script>

const PASSWORD="wlstjfrladbstlr"

/* ì—¬ê¸°ë§Œ ìˆ˜ì • */

const token="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"
const repo="sdsd824-ux/repo"

/* -------- */

let picked="ğŸŒ"
let editIndex=null

const iconList=["ğŸŒ","ğŸ“Š","ğŸ¥","ğŸ“","â­","ğŸ’¬","ğŸ“…","ğŸ§¾"]

function login(){

if(pw.value===PASSWORD){

loginBox.style.display="none"
adminBox.style.display="block"

init()

}else{
alert("ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼")
}

}

async function init(){

renderIcons()

let cats=await loadCats()

updateCatSelect(cats)
renderCatList(cats)
loadSites()

}

function renderIcons(){

icons.innerHTML=""

iconList.forEach(i=>{

let s=document.createElement("span")
s.innerText=i

if(i===picked) s.classList.add("active")

s.onclick=()=>{
picked=i
renderIcons()
}

icons.appendChild(s)

})

}

async function save(){

if(siteName.value.trim()=="" || siteUrl.value.trim()==""){
alert("ì´ë¦„ / URL ì…ë ¥")
return
}

let data=JSON.parse(localStorage.getItem("sites")||"[]")

let site={
name:siteName.value,
url:siteUrl.value,
icon:picked,
category:category.value
}

if(editIndex===null){
data.push(site)
}else{
data[editIndex]=site
}

localStorage.setItem("sites",JSON.stringify(data))

await uploadToGitHub("sites.json",data)

clearForm()
loadSites()

}

function clearForm(){

siteName.value=""
siteUrl.value=""
picked="ğŸŒ"
editIndex=null
editingText.innerText=""

renderIcons()

}

function cancelEdit(){
clearForm()
}

function loadSites(){

let data=JSON.parse(localStorage.getItem("sites")||"[]")

list.innerHTML=""

data.forEach((s,i)=>{

let d=document.createElement("div")
d.className="row"

d.innerHTML=`
<div>${s.icon} ${s.name} (${s.category})</div>
<div>
<button onclick="edit(${i})">ìˆ˜ì •</button>
<button onclick="del(${i})">ì‚­ì œ</button>
</div>
`

list.appendChild(d)

})

}

function edit(i){

let data=JSON.parse(localStorage.getItem("sites")||"[]")
let s=data[i]

siteName.value=s.name
siteUrl.value=s.url
category.value=s.category

picked=s.icon

editIndex=i

editingText.innerHTML='<span class="editing">(ìˆ˜ì • ì¤‘)</span>'

renderIcons()

window.scrollTo({top:0,behavior:"smooth"})

}

async function del(i){

let data=JSON.parse(localStorage.getItem("sites")||"[]")

data.splice(i,1)

localStorage.setItem("sites",JSON.stringify(data))

await uploadToGitHub("sites.json",data)

loadSites()

}

async function addCat(){

let cats=JSON.parse(localStorage.getItem("cats")||'["ì „ì²´"]')

let name=newCat.value.trim()

if(name=="" || cats.includes(name)){
alert("ì´ë¯¸ ì¡´ì¬í•˜ê±°ë‚˜ ë¹ˆ ì´ë¦„")
return
}

cats.push(name)

localStorage.setItem("cats",JSON.stringify(cats))

await uploadToGitHub("cats.json",cats)

newCat.value=""

init()

}

function renderCatList(cats){

catList.innerHTML=""

cats.forEach((c,i)=>{

if(c==="ì „ì²´") return

let d=document.createElement("div")
d.className="row"

d.innerHTML=`
<div>${c}</div>
<button onclick="delCat(${i})">ì‚­ì œ</button>
`

catList.appendChild(d)

})

}

async function delCat(i){

let cats=JSON.parse(localStorage.getItem("cats")||'["ì „ì²´"]')

cats.splice(i,1)

localStorage.setItem("cats",JSON.stringify(cats))

await uploadToGitHub("cats.json",cats)

init()

}

function updateCatSelect(cats){

category.innerHTML=""

cats.forEach(c=>{

let o=document.createElement("option")
o.text=c
category.add(o)

})

}

/* GitHub ì—…ë¡œë“œ */

async function uploadToGitHub(filename,data){

const url=`https://api.github.com/repos/${repo}/contents/${filename}`

let sha=null

const res=await fetch(url)

if(res.ok){
const file=await res.json()
sha=file.sha
}

await fetch(url,{
method:"PUT",
headers:{
Authorization:"Bearer "+token,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"update "+filename,
content:btoa(unescape(encodeURIComponent(JSON.stringify(data,null,2)))),
sha:sha
})
})

}

async function loadCats(){

try{
let res=await fetch("cats.json")
let data=await res.json()
localStorage.setItem("cats",JSON.stringify(data))
return data
}catch{
return JSON.parse(localStorage.getItem("cats")||'["ì „ì²´"]')
}

}

</script>

</body>
</html>
