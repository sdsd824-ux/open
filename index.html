<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>업무 포털</title>

<style>

body{
font-family:Arial;
background:#f4f6fb;
margin:0;
padding:40px;
}

.container{
max-width:1200px;
margin:auto;
}

h1{
text-align:center;
font-size:42px;
margin-bottom:10px;
}

.sub{
text-align:center;
margin-bottom:40px;
color:#666;
}

.topbar{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:20px;
}

.search{
width:300px;
padding:10px;
font-size:16px;
border-radius:8px;
border:1px solid #ccc;
}

.loginBtn{
padding:10px 18px;
border:none;
background:#222;
color:white;
border-radius:8px;
cursor:pointer;
}

.categories{
margin-bottom:20px;
}

.catBtn{
border:none;
background:#e7ebf4;
padding:8px 14px;
border-radius:8px;
margin-right:6px;
cursor:pointer;
}

.catActive{
background:#4c7cff;
color:white;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
gap:20px;
}

.card{
background:white;
border-radius:14px;
padding:25px;
text-align:center;
cursor:pointer;
position:relative;
box-shadow:0 4px 12px rgba(0,0,0,0.06);
transition:.15s;
}

.card:hover{
transform:translateY(-4px);
}

.icon{
width:36px;
height:36px;
margin-bottom:10px;
}

.star{
position:absolute;
top:10px;
right:12px;
font-size:18px;
cursor:pointer;
}

.category{
font-size:12px;
color:#888;
margin-top:4px;
}

.admin{
margin-top:30px;
text-align:center;
}

.addBtn{
padding:12px 20px;
border:none;
background:#4c7cff;
color:white;
border-radius:8px;
cursor:pointer;
margin:5px;
}

.editBtn{
position:absolute;
left:10px;
top:10px;
font-size:14px;
cursor:pointer;
}

</style>
</head>

<body>

<div class="container">

<h1>업무 포털</h1>
<div class="sub">자주 사용하는 사이트</div>

<div class="topbar">
<input class="search" placeholder="검색" id="search">
<button class="loginBtn" onclick="login()">로그인</button>
</div>

<div id="categories" class="categories"></div>

<div id="grid" class="grid"></div>

<div class="admin" id="adminPanel" style="display:none">
<button class="addBtn" onclick="addSite()">사이트 추가</button>
<button class="addBtn" onclick="manageCategories()">카테고리 관리</button>
</div>

</div>

<script>

let currentUser=localStorage.getItem("portal_user") || ""
let isAdmin=false

if(currentUser==="김윤식"){
isAdmin=true
}

let defaultSites=[
{
name:"환자 내원 분석",
url:"https://sdsd824-ux.github.io/visitrate/",
icon:"auto",
category:"분석"
}
]

let sites=JSON.parse(localStorage.getItem("portal_sites")||"null") || defaultSites

let favorites=JSON.parse(localStorage.getItem("fav_"+currentUser)||"[]")

let categories=JSON.parse(localStorage.getItem("portal_categories")||"null") || ["전체","분석"]

let currentCategory="전체"

function save(){

localStorage.setItem("portal_sites",JSON.stringify(sites))
localStorage.setItem("portal_categories",JSON.stringify(categories))

}

function renderCategories(){

let box=document.getElementById("categories")
box.innerHTML=""

categories.forEach(cat=>{

let btn=document.createElement("button")
btn.className="catBtn"

if(cat===currentCategory) btn.classList.add("catActive")

btn.innerText=cat

btn.onclick=()=>{
currentCategory=cat
render()
}

box.appendChild(btn)

})

}

function render(){

renderCategories()

let keyword=document.getElementById("search").value.toLowerCase()

let grid=document.getElementById("grid")
grid.innerHTML=""

let sorted=[...sites].sort((a,b)=>{
let af=favorites.includes(a.url)?0:1
let bf=favorites.includes(b.url)?0:1
return af-bf
})

sorted.forEach(site=>{

if(currentCategory!=="전체" && site.category!==currentCategory) return

if(keyword && !site.name.toLowerCase().includes(keyword)) return

let card=document.createElement("div")
card.className="card"
card.draggable=isAdmin

let icon=""

if(site.icon==="auto"){
icon=`https://www.google.com/s2/favicons?sz=64&domain_url=${site.url}`
}else{
icon=site.icon
}

let star=favorites.includes(site.url)?"★":"☆"

card.innerHTML=`

${isAdmin?'<div class="editBtn">⚙</div>':''}
<div class="star">${star}</div>
<img class="icon" src="${icon}">
<div><b>${site.name}</b></div>
<div class="category">${site.category||""}</div>

`

card.onclick=()=>window.open(site.url,"_blank")

card.querySelector(".star").onclick=(e)=>{
e.stopPropagation()
toggleFav(site.url)
}

if(isAdmin){

card.querySelector(".editBtn").onclick=(e)=>{
e.stopPropagation()
editSite(site)
}

card.ondragstart=(e)=>{
e.dataTransfer.setData("url",site.url)
}

card.ondragover=(e)=>e.preventDefault()

card.ondrop=(e)=>{
let dragged=e.dataTransfer.getData("url")
reorder(dragged,site.url)
}

}

grid.appendChild(card)

})

document.getElementById("adminPanel").style.display=isAdmin?"block":"none"

}

function reorder(a,b){

let from=sites.findIndex(s=>s.url===a)
let to=sites.findIndex(s=>s.url===b)

let item=sites.splice(from,1)[0]
sites.splice(to,0,item)

save()
render()

}

function toggleFav(url){

if(favorites.includes(url)){
favorites=favorites.filter(f=>f!==url)
}else{
favorites.push(url)
}

localStorage.setItem("fav_"+currentUser,JSON.stringify(favorites))
render()

}

function login(){

let name=prompt("이름")

if(!name) return

if(name==="김윤식"){

let pass=prompt("관리자 비밀번호")

if(pass!=="진설김윤식"){
alert("비밀번호 틀림")
return
}

isAdmin=true

}

currentUser=name

localStorage.setItem("portal_user",name)

favorites=JSON.parse(localStorage.getItem("fav_"+currentUser)||"[]")

render()

}

function addSite(){

let name=prompt("사이트 이름")
if(!name) return

let url=prompt("사이트 주소")
if(!url) return

let category=prompt("카테고리",categories[1]||"")

let iconType=prompt("아이콘\n1 자동\n2 이모지\n3 이미지URL")

let icon="auto"

if(iconType==="2") icon=prompt("이모지 입력")
if(iconType==="3") icon=prompt("이미지 주소")

sites.push({
name,
url,
icon,
category
})

if(!categories.includes(category)) categories.push(category)

save()
render()

}

function editSite(site){

let name=prompt("이름",site.name)
let url=prompt("주소",site.url)
let category=prompt("카테고리",site.category)

site.name=name
site.url=url
site.category=category

save()
render()

}

function manageCategories(){

let action=prompt("1 추가\n2 삭제")

if(action==="1"){

let name=prompt("카테고리 이름")

if(name && !categories.includes(name)){

categories.push(name)

}

}

if(action==="2"){

let name=prompt("삭제할 카테고리")

categories=categories.filter(c=>c!==name)

}

save()
render()

}

document.getElementById("search").addEventListener("input",render)

render()

</script>

</body>
</html>
